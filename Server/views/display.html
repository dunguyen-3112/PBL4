<html lang="en">

<head>
    <title>Teamviewer</title>
    <link rel="stylesheet" href="../public/style.css">
</head>

<body>

    <div id="ip"></div>
    <div class="btn">
        <input type="button" onclick="openFullscreen()" class="a124" id="a124" value="Full Screen">
        <input type="button" onclick="closeFullscreen()" class="a123" id="a123" style="display: none;" value="Exit Screen">
    </div>
    <img style="width:1440; height:810; margin-top: 0; margin-left: 2%" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" crossorigin="anonymous"></script>
    <script>
        var elem = document.documentElement;

        function openFullscreen() {
            document.getElementById('a123').style.display = 'block';
            document.getElementById('a124').style.display = 'none'
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }

        function closeFullscreen() {
            document.getElementById('a124').style.display = 'block';
            document.getElementById('a123').style.display = 'none'
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        window.onload = function() {

            var room = prompt("IP of you " + "Please enter room ID : ");
            if (room == '' && room.length == 0) {
                document.write("<h1> Room ID is mandatory to join </h1>");
                return;
            }

            socket = io.connect('http://localhost:5000');

            socket.emit("join-message", room);
            socket.on('screen-data', function(message) {
                $("img").attr("src", "data:image/png;base64," + message);
            })

            $("img").mousemove(function(e) {
                e.preventDefault();
                var posX = $(this).offset().left;
                var posY = $(this).offset().top;

                var x = e.pageX - posX;
                var y = e.pageY - posY;

                var obj = {
                    "x": x,
                    "y": y,
                    "room": room
                }
                socket.emit("mouse-move", JSON.stringify(obj));

            })

            $("img").mousedown(function(e) {
                e.preventDefault()
                var obj = {
                    "e": e.button,
                    "room": room
                };
                socket.emit("mouse-click", JSON.stringify(obj));
            })

            $('img').on('contextmenu', function(e) {
                e.preventDefault()
            })

            $(window).bind("keyup", function(e) {
                e.preventDefault();
                var key = e.key;
                key = key.toLowerCase()
                var obj = {
                    "key": key,
                    "room": room
                };
                socket.emit("type-up", JSON.stringify(obj));
            })
             $(window).bind("keydown", function(e) {
                e.preventDefault();
                var key = e.key;
                key = key.toLowerCase()
                if(key.localeCompare('shift') === 0 || key.localeCompare('control') === 0) {
                    var obj = {
                    "key": key,
                    "room": room
                    };
                    socket.emit("type-down", JSON.stringify(obj));
                }
            })
        }
    </script>
</body>

</html>
